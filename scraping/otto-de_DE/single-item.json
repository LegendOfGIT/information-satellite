{
  "site": "otto.de",

  "itemId": "{template.site}-{request.query.itemId}",

  "scraping": [
    {
      "comment": "site",
      "commandId": "set-context-value",
      "parameters": {
        "contextId": "site",
        "value": "otto-de_DE"
      }
    },
    {
      "comment": "link",
      "commandId": "set-context-value",
      "parameters": {
        "contextId": "link",
        "value": "https://{template.site}/p/{request.query.itemId}"
      }
    },
    {
      "comment": "single-product-view",
      "commandId": "visit-uri",
      "parameters": {
        "contextId": "single-product-view",
        "uri": "https://{template.site}/p/{request.query.itemId}"
      }
    },
    {
      "comment": "title",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "title",
        "sourceContextId": "single-product-view",
        "css-queries": [ ".pdp_variation-name" ]
      }
    },
    {
      "comment": "price-current",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "price-current",
        "sourceContextId": "single-product-view",
        "css-queries": [ ".pdp_price__retail-price .pl_headline300" ]
      }
    },
    {
      "comment": "price-initial",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "price-initial",
        "sourceContextId": "single-product-view",
        "css-queries": [ ".pdp_price__strike-through-price", ".pdp_price__retail-price", ".pdp_price__retail-price .pl_headline300" ]
      }
    },
    {
      "comment": "price-current to float",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "price-current",
        "sourceContextId": "price-current"
      }
    },
    {
      "comment": "price-initial to float",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "price-initial",
        "sourceContextId": "price-initial"
      }
    },

    {
      "comment": "weight in grams",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "weightInG",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "Gewicht:.*?ca.(.*?)g<",
          "Gewicht:(.*?)g<",
          ">Gewicht.*?<td>(.*?) g<"
        ]
      }
    },
    {
      "comment": "weight in grams to float",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "weightInG",
        "sourceContextId": "weightInG"
      }
    },

    {
      "comment": "width-in-mm",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "width-in-mm",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "Breite:(.*)mm<\\/li>"
        ]
      }
    },
    {
      "comment": "width-in-mm to float",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "width-in-mm",
        "sourceContextId": "width-in-mm"
      }
    },

    {
      "comment": "description",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "description",
        "sourceContextId": "single-product-view",
        "separator": " ",
        "css-queries": [
          ".js_prd_moreBox__content",
          ".pdp_description__text-expander p",
          ".pdp_description__text-expander",
          ".pdp_selling-points ul li"
        ]
      }
    },
    {
      "comment": "raw description",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "descriptionRaw",
        "flags": "sg",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "removeTags": false,
        "regex": [
          "<.*?pdp_description__text-expander.*?>((\\n|.)*?)<\\/div"
        ]
      }
    },
    {
      "comment": "description headlines",
      "commandId": "get-values-by-regex",
      "parameters": {
        "contextId": "descriptions.headline",
        "flags": "gm",
        "sourceContextId": "descriptionRaw",
        "groupIndex": 1,
        "regex": [
          "<p><b>(.*?)<\\/b><\\/p>",
          "<b>(.*?)<.*?<br.*?>(.*?)((\\n|.)*?)<br",
          "<strong>(.*?)<",
          "<p>\\[(.*?)\\](-|:)",
          "<\\/p>.*?<b>(.*?)<\\/b>.*?(<\\/p>|<br \\/>)",
          "<p>(.*?)(-|:)"
        ]
      }
    },
    {
      "comment": "description contents",
      "commandId": "get-values-by-regex",
      "parameters": {
        "contextId": "descriptions.content",
        "flags": "gm",
        "sourceContextId": "descriptionRaw",
        "groupIndex": 3,
        "regex": [
          "<\\/b>()<\\/p>.*?<p>(.*?)((\\n|.)*?)<\\/p>",
          "<b>(.*?)<.*?<br.*?>(.*?)((\\n|.)*?)<br",
          "<strong>(.*?)()<.*?><br \\/>((\\n|.)*?)<p>",
          "<strong>(.*?)()<.*?>((\\n|.)*?)<",
          "<p>\\[(.*?)\\](-|:)(.*?)<\\/p>",
          "<\\/p>.*?<b>(.*?)<\\/b>.*?(<\\/p>|<br \\/>)(.*?)<ul",
          "<p>(.*?)(-|:)(.*?)<\\/p>"
        ]
      }
    },
    {
      "comment": "descriptions",
      "commandId": "zip-contexts-to-context",
      "parameters": {
        "contextId": "descriptions",
        "exchangeFromWhenEmpty": "headline",
        "exchangeToWhenEmpty": "content",
        "sourceContextIds": [ "descriptions.headline", "descriptions.content" ]
      }
    },

    {
      "comment": "usk-age",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "minimumAge",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "<span>USK-Freigabe.*?<td>(.*?)<\/td>"
        ]
      }
    },
    {
      "comment": "minimumAge",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "minimumAge",
        "sourceContextId": "minimumAge"
      }
    },
    {
      "comment": "Minimum age in months",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "minimumAgeInMonths",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "Anwendbares Alter:(.*?)Monate<"
        ]
      }
    },
    {
      "comment": "Minimum age in months",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "minimumAgeInMonths",
        "sourceContextId": "minimumAgeInMonths"
      }
    },

    {
      "comment": "multiplayer",
      "commandId": "set-context-value",
      "parameters": {
        "contextId": "multiplayer",
        "value": false
      }
    },
    {
      "comment": "maximum players offline >> multiplayer",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "multiplayer",
        "sourceContextId": "single-product-view",
        "defaultValue": false,
        "setValueOnMatch": true,
        "regex": [
          "Anzahl Spieler \\(offline\\).*?bis zu(.*?)<\\/td>"
        ]
      }
    },
    {
      "comment": "maximum players online >> multiplayer",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "multiplayer",
        "sourceContextId": "single-product-view",
        "setValueOnMatch": true,
        "regex": [
          "Anzahl Spieler \\(online\\).*?(bis zu|Multi)(.*?)<\\/td>"
        ]
      }
    },

    {
      "comment": "genre-subgenre",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "genre-subgenre",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "genre.*?<\\/td><td>(.*?)<\\/td>+?"
        ]
      }
    },

    {
      "comment": "genre",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "genre",
        "sourceContextId": "genre-subgenre",
        "groupIndex": 1,
        "regex": [
          "(.*?)(<br.?\\/>)(.*?)(<br.?\\/>)",
          "(.*?)(-|<br.?\\/>).*?(.*)",
          "(.*)"
        ]
      }
    },
    {
      "comment": "subgenre",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "subgenre",
        "sourceContextId": "genre-subgenre",
        "groupIndex": 3,
        "regex": [
          "(.*?)(<br.?\\/>)(.*?)(<br.?\\/>)",
          "(.*?)(-|<br.?\\/>).*?(.*)"
        ]
      }
    },

    {
      "comment": "publisher",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "publisher",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "<span>Publisher.*?<td>(.*?)<\/td>"
        ]
      }
    },
    {
      "comment": "material",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "material",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "Material:(.*?)<\/li>",
          ">Material.*?<td>(.*?)<",
          "Material:(.*?)<br \\/>"
        ]
      }
    },
    {
      "comment": "Annual consumption",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "annualConsumptionInKWH",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Jährlicher Energieverbrauch.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "Annual consumption",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "annualConsumptionInKWH",
        "sourceContextId": "annualConsumptionInKWH"
      }
    },
    {
      "comment": "color",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "color",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Farbe Front.*?<td>(.*?)<",
          ">Farbe<\\/span>.*?<td>(.*?)<",
          ">Farbe.*?<td>(.*?)<",
          "Farbe:(.*?)<br \\/>"
        ]
      }
    },
    {
      "comment": "lock type",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "lock-type",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Verschlussart.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "model",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "model",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Modellbezeichnung.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "size",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "size",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Größe.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "minimum energy efficiency class",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "minimumEnergyEfficiencyClass",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Energieeffizienzklasse.*?<td>.*?\\((.*?) bis (.*?)\\)<"
        ]
      }
    },
    {
      "comment": "maximum energy efficiency class",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "maximumEnergyEfficiencyClass",
        "sourceContextId": "single-product-view",
        "groupIndex": 2,
        "regex": [
          ">Energieeffizienzklasse.*?<td>.*?\\((.*?) bis (.*?)\\)<"
        ]
      }
    },
    {
      "comment": "drawer amount",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "drawerAmount",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Anzahl .*?chubladen.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "drawer amount",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "drawerAmount",
        "sourceContextId": "drawerAmount"
      }
    },
    {
      "comment": "key amount",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "keyAmount",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Anzahl Tasten.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "key amount",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "keyAmount",
        "sourceContextId": "keyAmount"
      }
    },
    {
      "comment": "height in cm",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "height-in-cm",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Höhe.*?<td>(.*?) cm<"
        ]
      }
    },
    {
      "comment": "height in cm",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "height-in-cm",
        "sourceContextId": "height-in-cm"
      }
    },
    {
      "comment": "width in cm",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "width-in-cm",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Breite.*?<td>(.*?) cm<"
        ]
      }
    },
    {
      "comment": "width in cm",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "width-in-cm",
        "sourceContextId": "width-in-cm"
      }
    },

    {
      "comment": "length in cm",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "length-in-cm",
        "sourceContextId": "single-product-view",
        "groupIndex": 2,
        "regex": [
          ">(Länge|Tiefe).*?<td>(.*?) cm<"
        ]
      }
    },
    {
      "comment": "length in cm",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "length-in-cm",
        "sourceContextId": "length-in-cm"
      }
    },

    {
      "comment": "weight in KG",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "weightInKG",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Gewicht.*?<td>(.*?) kg<"
        ]
      }
    },
    {
      "comment": "weight in KG",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "weightInKG",
        "sourceContextId": "weightInKG"
      }
    },

    {
      "comment": "Maximum velocity in Kmh",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "maximumVelocityInKmh",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Höchstgeschwindigkeit.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "Maximum velocity in Kmh",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "maximumVelocityInKmh",
        "sourceContextId": "maximumVelocityInKmh"
      }
    },

    {
      "comment": "Battery range in Km",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "batteryRangeInKm",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Reichweite Akku.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "Battery range in Km",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "batteryRangeInKm",
        "sourceContextId": "batteryRangeInKm"
      }
    },

    {
      "comment": "Battery charging time in hours",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "batteryChargingTimeInHours",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Ladezeit Akku.*?<td>(.*?)<"
        ]
      }
    },
    {
      "comment": "Battery charging time in hours",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "batteryChargingTimeInHours",
        "sourceContextId": "batteryChargingTimeInHours"
      }
    },

    {
      "comment": "screensize in inch",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "screensizeInInch",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Bildschirmdiagonale in Zoll.*?<td>(.*?) &#34;<"
        ]
      }
    },
    {
      "comment": "screensize in inch",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "screensizeInInch",
        "sourceContextId": "screensizeInInch"
      }
    },

    {
      "comment": "resolution",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "resolution",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Bildschirmauflösung.*?<td>(.*?)<"
        ]
      }
    },

    {
      "comment": "storage size",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "storageSize",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Speichergröße.*?<td>(.*?)<"
        ]
      }
    },

    {
      "comment": "speed key",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "speedKey",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Geschwindigkeitsindex.*?<td>(.*?)<"
        ]
      }
    },

    {
      "comment": "pump pressure in bar",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "pumpPressureInBar",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Pumpendruck.*?<td>(.*?) bar<"
        ]
      }
    },
    {
      "comment": "pump pressure in bar",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "pumpPressureInBar",
        "sourceContextId": "pumpPressureInBar"
      }
    },

    {
      "comment": "battery life in hours",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "batteryLifeInHours",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          ">Akkulaufzeit.*?<td>(.*?) Std.<"
        ]
      }
    },
    {
      "comment": "battery life in hours",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "batteryLifeInHours",
        "sourceContextId": "batteryLifeInHours"
      }
    },

    {
      "comment": "merchant article number",
      "commandId": "set-context-value",
      "parameters": {
        "contextId": "mean",
        "value": "otto.{request.query.itemId}"
      }
    },
    {
      "comment": "gtin",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "gtin",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": "gtin13\": \"(.*?)\""
      }
    },
    {
      "comment": "gtins",
      "commandId": "set-context-value",
      "parameters": {
        "contextId": "gtins",
        "value": "{gtin}"
      }
    },
    {
      "comment": "images-big",
      "commandId": "get-values-by-regex",
      "parameters": {
        "contextId": "images-big",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "replacements": {
          "$": "?",
          "\\?.*": "?h=450&w=450&sm=clamp&upscale=true&fmt=auto"
        },
        "regex": [ "data-image-src=\"(https.*?)\"" ]
      }
    },
    {
      "comment": "add small versions of images-big",
      "commandId": "clone-items-and-modify-clones",
      "parameters": {
        "contextId": "images-small",
        "sourceContextId": "images-big",
        "replacements": {
          "$": "?",
          "\\?.*": "?h=150&w=150&sm=clamp&upscale=true&fmt=auto"
        }
      }
    },
    {
      "comment": "title-image",
      "commandId": "get-value-from-array",
      "parameters": {
        "contextId": "title-image",
        "sourceContextId": "images-big"
      }
    },

    {
      "comment": "number of ratings",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "numberOfRatings",
        "sourceContextId": "single-product-view",
        "css-queries": [ "span[data-target='allreviewscount']" ]
      }
    },
    {
      "comment": "number of ratings",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "numberOfRatings",
        "defaultValue": 0,
        "sourceContextId": "numberOfRatings"
      }
    },

    {
      "comment": "rating",
      "commandId": "get-value-by-css-queries",
      "parameters": {
        "contextId": "ratingInPercent",
        "sourceContextId": "single-product-view",
        "css-queries": [ ".cr_ratingContainer h1" ]
      }
    },
    {
      "comment": "rating",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "ratingInPercent",
        "defaultValue": 0,
        "sourceContextId": "ratingInPercent"
      }
    },
    {
      "comment": "rating",
      "commandId": "get-rule-of-three-value",
      "parameters": {
        "maximumValue": 5,
        "contextId": "ratingInPercent"
      }
    },

    {
      "comment": "brand",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "brand",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": "Brand\", \"name\": \"(.*?)\""
      }
    },

    {
      "comment": "teaser texts",
      "commandId": "get-values-by-css-queries",
      "parameters": {
        "contextId": "teaser-texts",
        "sourceContextId": "single-product-view",
        "css-queries": [ ".pdp_selling-points ul li" ]
      }
    },

    {
      "comment": "amount in stock",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "amountInStock",
        "sourceContextId": "single-product-view",
        "groupIndex": 1,
        "regex": [
          "\"hd_Stock\":\\[\"(.*?)\"\\]"
        ]
      }
    },
    {
      "comment": "amount in stock",
      "commandId": "get-float-from-value",
      "parameters": {
        "contextId": "amountInStock",
        "defaultValue": 0,
        "sourceContextId": "amountInStock"
      }
    },

    {
      "comment": "seoKeywords",
      "commandId": "extract-seo-keywords",
      "parameters": {
        "contextId": "seoKeywords",
        "sourceContextId": ["description", "title"]
      }
    },

    {
      "comment": "removeProviderFlag",
      "commandId": "get-value-by-regex",
      "parameters": {
        "contextId": "removeProviderFlag",
        "sourceContextId": "single-product-view",
        "setValueOnMatch": true,
        "setValueOnMiss": false,
        "regex": "Wir konnten die Seite, die du aufrufen wolltest, leider nicht finden."
      }
    },
    {
      "comment": "remove provider when product can not be found anymore",
      "commandId": "remove-provider",
      "parameters": {
        "flagId": "removeProviderFlag"
      }
    },

    {
      "comment": "store scraped information",
      "commandId": "store-information",
      "parameters": {
        "informationIds": [
          "amountInStock",
          "annualConsumptionInKWH",
          "batteryChargingTimeInHours",
          "batteryLifeInHours",
          "batteryRangeInKm",
          "brand",
          "color",
          "description",
          "descriptions",
          "drawerAmount",
          "keyAmount",
          "gtin",
          "height-in-cm",
          "images-big",
          "images-small",
          "genre",
          "length-in-cm",
          "lock-type",
          "link",
          "material",
          "maximumEnergyEfficiencyClass",
          "mean",
          "maximumVelocityInKmh",
          "minimumAge",
          "minimumAgeInMonths",
          "minimumEnergyEfficiencyClass",
          "model",
          "multiplayer",
          "numberOfRatings",
          "price-current",
          "price-initial",
          "publisher",
          "pumpPressureInBar",
          "ratingInPercent",
          "resolution",
          "screensizeInInch",
          "seoKeywords",
          "size",
          "speedKey",
          "storageSize",
          "subgenre",
          "teaser-texts",
          "title",
          "title-image",
          "weightInKG",
          "weightInG",
          "width-in-cm",
          "width-in-mm"
        ]
      }
    }
  ]
}
